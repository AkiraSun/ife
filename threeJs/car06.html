<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="UTF-8">
        <title>任务六 - 导入外部模型</title>
    </head>
    <body>
        <canvas id="main" width="800" height="600"></canvas>
        <script src="./three.min.js"></script>
        <script src="./TrackballControls.js"></script>
        <script src="./OBJLoader.js"></script>
        <script src="./MTLLoader.js"></script>
        <script>
var renderer, camera, car
// 获取到浏览器内容宽高
var ww = window.innerWidth,
    wh = window.innerHeight
renderer = new THREE.WebGLRenderer({
    canvas: document.getElementById('main')
})
renderer.setSize(ww, wh)
// 场景
var scene = new THREE.Scene()
// 照相机
camera = new THREE.PerspectiveCamera(50, ww / wh, 0.1, 10000);
camera.position.set(600, 300, 1500);
camera.lookAt(new THREE.Vector3(0, 0, 0));
scene.add(camera);
// 灯光
var directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
directionalLight.position.set(0, 0, 350);
directionalLight.lookAt(new THREE.Vector3(0, 0, 0));
scene.add(directionalLight);
// 创建好照相机后，创建控制器来控制照相机
var controls = new THREE.TrackballControls(camera, document.querySelector('#main'))
// 设置旋转、缩放和 ？ 的速率
controls.rotateSpeed = 1.0
controls.zoomSpeed = 1.2
controls.panSpeed = 0.8

controls.noZoom = false
controls.noPan = false

controls.staticMoving = true
controls.dynamicDampingFactor = 0.3

controls.keys = [65, 83, 68]
controls.addEventListener('change', render)

//Manager from ThreeJs to track a loader and its status
var manager = new THREE.LoadingManager()
//Loader for Obj from Three.js
var loader = new THREE.OBJLoader(manager)

//Launch loading of the obj file, addBananaInScene is the callback when it's ready 
loader.load('./car/car.obj', function(object) {
    car = object
    //Move the car in the scene
    // car.rotation.x = Math.PI / 2;
    car.position.y = -200
    car.position.z = 50
    //Go through all children of the loaded object and search for a Mesh
    object.traverse(function(child) {
        //This allow us to check if the children is an instance of the Mesh constructor
        if (child instanceof THREE.Mesh) {
            // child.material.color = new THREE.Color(0X00FF00);
            //Sometimes there are some vertex normals missing in the .obj files, ThreeJs will compute them
            child.geometry.computeVertexNormals()
        }
    })

    scene.add(car)
    render()
})
/* ============================
 * 任务四增加的部分
 =============================*/
animate()

function animate() {
    requestAnimationFrame(animate)
    controls.update()
}
// 调用该函数将重新渲染一次
function render() {
    renderer.render(scene, camera)
}
/* ============================
 * 结束
 =============================*/
        </script>
    </body>
</html>
